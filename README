
After installation you should download the java binary from http://www.oracle.com/technetwork/java/javase/downloads/jdk-6u31-download-1501634.htmland place it in puppet/modules/java/files/.

Execute the following commands
cd puppet
tar czf ../jajc/modules.tgz modules/
cd ../jajc

Now you have a modules.tgz file in the directory where the pom is.

Define your setup in setup.yml, only byon works at the moment, make sure the hostnames are resolvable and each host has a correct /etc/hosts file. Make sure there is at least a cdh3::hadoop::namenode and a puppetmaster in the roles section. Other roles can be found in ../puppet/modules/cdh3/*.pp files. The zookeeper service and hbase service classes do not fully work

Execute mvn exec:java


After a while the build will be completed and puppet should run on the cluster.
Some checks to quickly see if the agents are installing their configuration:
ls /opt -> this should contain the jdk1.6.0_31 directory
ls /etc/apt/sources.list.d/ -> this should contain cloudera.list

Configuration files like zoo.cfg and hdfs-site.xml should have the correct content.
For now set the following environmental variables manually as root:
export JAVA_HOME=/opt/jdk1.6.0_31



If you chose the cdh3::hadoop::namenode::postinstall module you should be able to see the webinterface of the namenode on <hostname namenode>:50070

Start the jobtracker and the namenodes on the correct nodes:
/etc/init.d/hadoop-0.20-jobtracker start
/etc/init.d/hadoop-0.20-tasktracker start
Go to <hostname jobtracker>:50030 to check if the jobtracker and the tasktrackers are running

Start ZooKeeper on the zookeeper nodes:
export FACTER_zooid=n # check /etc/zookeeper/zoo.cfg to find n, it depends on the hostname

/usr/lib/zookeeper/bin/zkServer.sh start
Check if you can connect to the nodes by checking if you can use the zookeeper command line interface:
/usr/lib/zookeeper/bin/zkCli.sh
Type quit to leave the zookeeper CLI.

Start HBasemaster and regionserver:
/etc/init.d/hadoop-hbase-master start
/etc/init.d/hadoop-hbase-regionserver start
Go to <hostname hbasemaster>:60010 to check if the hbase master and the regionservers are running




Debugging:
Log in to the puppetmaster node, kill both the puppet services (master and agent) and execute the following command:
/opt/ruby/bin/puppet master --verbose --no-daemonize

Log into another node, kill puppet process and execute:
/opt/ruby/bin/puppet agent --verbose --no-daemonize


CREDITS:
apt module from https://github.com/camptocamp/puppet-apt